#!/bin/bash

CIPHER_OPTS="-m aes-256-cfb"
PASSWORD_OPTS="-k $PASSWORD"
VERBOSE_OPTS=$VERBOSE

case $SERVICE in
  server)
    HOST_OPTS="-s 0.0.0.0"
    PORT_OPTS="-p $SERVER_PORT"
    ;;
  tunnel)
    HOST_OPTS="-s $SERVER_ADDR"
    PORT_OPTS="-p $SERVER_PORT"
    LOCAL_BIND_ADDR="-b 0.0.0.0"
    LOCAL_PORT_OPTS="-l $LOCAL_PORT"
    FORWARD_OPTS="-L ${FORWARD_ADDR}:${FORWARD_PORT}"
    UDPRELAY_OPTS="-u"
    ;;
  local)
    HOST_OPTS="-s $SERVER_ADDR"
    PORT_OPTS="-p $SERVER_PORT"
    LOCAL_BIND_ADDR="-b 0.0.0.0"
    LOCAL_PORT_OPTS="-l $LOCAL_PORT"
    ;;
  *)
    exit 1
    ;;
esac

exec /usr/local/bin/ss-${SERVICE} $CIPHER_OPTS $PASSWORD_OPTS $HOST_OPTS $PORT_OPTS $LOCAL_BIND_ADDR $LOCAL_PORT_OPTS $FORWARD_OPTS $UDPRELAY_OPTS $VERBOSE_OPTS
